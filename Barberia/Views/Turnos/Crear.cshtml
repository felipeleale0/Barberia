@* @using Barberia.Models.Domain
@model Turno
@{
    ViewData["Title"] = "Agendar Turno";
}

<div class="contenedor">
    <h1 class="titulo"><i class="fa-solid fa-calendar-plus"></i> Agendar Turno</h1>

    <form asp-action="Crear" method="post" class="formulario">
        <!-- Cliente -->
        <div class="grupo">
            <label>Cliente</label>
            <input asp-for="Cliente" class="input" placeholder="Nombre del cliente" required />
        </div>

        <!-- Barbero -->
        <div class="grupo">
            <label>Barbero</label>
            <select id="BarberoId" name="BarberoId" class="input" required>
                <option value="">-- Seleccionar Barbero --</option>
                @foreach (var barbero in ViewBag.Barberos)
                {
                    <option value="@barbero.Id">@barbero.Nombre</option>
                }
            </select>
        </div>

        <!-- Servicio (rellenado dinámicamente con AJAX) -->
        <div class="grupo">
            <label>Servicio</label>
            <select id="ServicioId" name="ServicioId" class="input" required>
                <option value="">-- Seleccionar Servicio --</option>
            </select>
        </div>

        <!-- Fecha y Hora -->
        <div class="grupo">
            <label>Fecha y Hora</label>
            <input asp-for="FechaHora" type="datetime-local" class="input" required />
        </div>

        <!-- Botones -->
        <div class="botones">
            <button type="submit" class="boton">Guardar</button>
            <a asp-action="Index" class="boton cancelar">Cancelar</a>
        </div>
    </form>
</div>

<!-- jQuery para la carga dinámica -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $("#BarberoId").change(function () {
        var idBarbero = $(this).val();
        $("#ServicioId").empty();

        if (idBarbero) {
            $.get("/Turnos/ObtenerServiciosPorBarbero", { barberoId: idBarbero }, function (data) {
                if (data.length === 0) {
                    $("#ServicioId").append('<option value="">(Este barbero no tiene servicios asignados)</option>');
                } else {
                    $("#ServicioId").append('<option value="">-- Seleccionar Servicio --</option>');
                    $.each(data, function (i, servicio) {
                        $("#ServicioId").append(`<option value="${servicio.id}">${servicio.nombre}</option>`);
                    });
                }
            });
        } else {
            $("#ServicioId").append('<option value="">-- Seleccionar Servicio --</option>');
        }
    });
</script>

<style>
    body {
        background-color: #111;
        color: #f8f8f8;
        font-family: 'Poppins', sans-serif;
    }

    .contenedor {
        margin: 40px auto;
        width: 90%;
        max-width: 500px;
        background-color: #1b1b1b;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
    }

    .titulo {
        color: #ffd700;
        margin-bottom: 25px;
        text-align: center;
    }

    .formulario .grupo {
        margin-bottom: 15px;
    }

    .formulario label {
        color: #ffd700;
        font-weight: bold;
        display: block;
        margin-bottom: 5px;
    }

    .input {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: none;
        background-color: #222;
        color: #fff;
    }

    select.input {
        height: 40px;
    }

    .botones {
        margin-top: 20px;
        display: flex;
        justify-content: space-between;
    }

    .boton {
        background-color: #ffd700;
        color: #000;
        padding: 10px 20px;
        border-radius: 10px;
        border: none;
        text-decoration: none;
        font-weight: bold;
        cursor: pointer;
        transition: 0.3s;
    }

        .boton:hover {
            background-color: #fff200;
        }

    .cancelar {
        background-color: #444;
        color: white;
    }

        .cancelar:hover {
            background-color: #666;
        }
</style> *@